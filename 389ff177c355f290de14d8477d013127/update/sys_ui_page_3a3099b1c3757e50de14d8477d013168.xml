<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_page">
    <sys_ui_page action="INSERT_OR_UPDATE">
        <category>general</category>
        <client_script><![CDATA[/* global window, GlideAjax, GlideModal */
/* eslint no-undef: "error" */
(function () {
	const searchExtensions = window.document.getElementById('search-extensions');
	const description = window.document.getElementById('searchgroup-description');
	window.document.querySelector('select#searchgroup')
		.addEventListener('change', function () {
		const group = this.selectedOptions[0];
		if (group.value != 'none') {
			searchExtensions.removeAttribute('checked');
			searchExtensions.setAttribute('disabled', '');
		} else {
			searchExtensions.removeAttribute('disabled');
		}

		description.innerText = group.dataset.description || '';
		description.style.marginTop = description.innerText ? '1rem' : '';
		const visibleContainerId = 'table-' + group.value + '-container';
		window.document.querySelectorAll('#table-select-container .table-container')
			.forEach((container) => {
			if (container.id == visibleContainerId) {
				container.style.display = '';
			} else {
				container.style.display = 'none';
			}
		});
	});

	const termLabel = window.document.querySelector('label[for=term]');
	window.document.getElementById('term').addEventListener('change', function () {
		termLabel
			.closest('.is-required')
			.classList[this.value ? 'add' : 'remove']('is-filled');
	});
})();

function clearSelections() {	
	return false;
}

function getResults() {
	const term = window.document.getElementById('term').value;
	if (term) {
		const errHandler = function (msg) {
			window.GlideUI.get().addOutputMessage({ type: 'error', msg: msg });
		};

		var scope = window.document.getElementById('scope').value;
		var group = window.document.getElementById('searchgroup').value;
		var extensions = window.document.getElementById('search-extensions').checked;
		var tableSysId = window.document.getElementById('table-' + group).value;
		if (tableSysId) {
			window.fetch('/api/now/table/sys_db_object/' + tableSysId + '?sysparm_fields=name', {
				headers: {
					'X-UserToken': window.g_ck
				}
			}).then(response => response.json()).then(json => {
				startSearch(term, {
					table: json.result.name,
					extensions: group == 'none' ? extensions : null,
					group: group == 'none' ? '' : group,
					scope
				}, errHandler);
			});
		} else if (group != 'none') {
			startSearch(term, { scope, group }, errHandler);
		}
	}

	return false;
}

function startSearch(term, context, errHandler) {
	const ga = new GlideAjax('x_itx_codesearch.CodeSearchUtilClient');
	ga.addParam('sysparm_name', 'startSearch');
	ga.addParam('term', term);
	ga.addParam('context', JSON.stringify(context));
	ga.getXMLAnswer(function (result) {
		result = JSON.parse(result);
		if (result?.status != 'success') {
			errHandler(result?.message || 'Unknown error on code search start');
			return;
		}
		const dd = new GlideModal('hierarchical_progress_viewer', false, '40em', '10em');
		dd.setTitle('Code Search for \'' + term + '\'');
		dd.setPreference('sysparm_renderer_execution_id', result.execution_id);

		let completed = false;
		dd.on('executionComplete', function () {
			completed = true;
		});
		dd.on('beforeclose', function () {
			if (!completed) {
				const ga = new GlideAjax('x_itx_codesearch.CodeSearchUtilClient');
				ga.addParam('sysparm_name', 'cancelSearch');
				ga.addParam('tracker', result.execution_id);
				ga.addParam('message', 'cancelled (window closed)');
				ga.getXMLAnswer(function (result) {
					if (!result?.status == 'success') {
						errHandler(result?.message || 'Unknown error during search cancellation');
					}
				});
			}
		});
		dd.render();
	});
}
]]></client_script>
        <description/>
        <direct>false</direct>
        <endpoint>x_itx_codesearch_search_async.do</endpoint>
        <html><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">

	<!--
		Credit to OOTB Code Search App
		CodeSearchExampleUse: /nav_to.do?uri=sys_ui_page.do?sys_id=8bc77fb2d7120200b6bddb0c825203ac
		CodeSearchExample: /nav_to.do?uri=sys_ui_macro.do?sys_id=9a7abeb2d7120200b6bddb0c82520308
	-->

	<g:evaluate>
		const tables = {};
		const searchTableGr = new GlideRecord('sn_codesearch_table');
		searchTableGr.addNotNullQuery('search_group');
		searchTableGr.orderBy('table');
		searchTableGr.query();
		while (searchTableGr.next()) {
			const group = searchTableGr.search_group.name.toString();
			(tables[group] ??= []).push(searchTableGr.table.toString());
		}

		const metadataTableGr = new GlideRecord('sys_db_object');
		metadataTableGr.addQuery('name', 'sys_metadata');
		metadataTableGr.setLimit(1);
		metadataTableGr.query();
		metadataTableGr.next();
	</g:evaluate>

	<style>
		form {
			width: 600px;
			margin: 20px auto 30px auto;
			border: 1px solid rgba(0, 0, 0, 0.2);
			padding: 35px;
			box-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
			border-radius: 3px;
		}

		label {
			padding-top: 7px;
		}

		.col-sm-9 {
			padding-left: inherit;
			padding-right: inherit;
		}

		.footer-buttons {
			display: block;
			text-align: right;
		}

		<j:if test="${!sn_ui.PolarisUI.canUsePolarisTemplates()}">
		#search-extensions-container label.checkbox-label {
			padding-bottom: 8px;
		}
		</j:if>
	</style>

	<g:ui_form>
		<div class="row form-group">
			<div class="col-sm-3 control-label is-required is-filled">
				<!-- no logic implemented to control is-filled currently,
					the marker only exists to notify that this field is important 
					(either search group or table must be selected)	
				-->
				<label class="required-marker" for="searchgroup">Search Group</label>
			</div>

			<span class="col-sm-9">
				<select id="searchgroup" class="form-control" name="group">
					<g:evaluate>
						const searchGroupGr = new GlideRecord('sn_codesearch_search_group');
						searchGroupGr.orderByDesc('sys_created_on');
						searchGroupGr.query();
					</g:evaluate>
					<option value="none">-- None --</option>
					<j:while test="${searchGroupGr.next()}">
						<option value="${searchGroupGr.sys_id}" data-description="${searchGroupGr.description}">
							${searchGroupGr.name}
						</option>
					</j:while>
				</select>
				<p id="searchgroup-description"></p>
			</span>
		</div>
		<div class="row form-group" id="table-select-container">
			<div class="col-sm-3 control-label is-required is-filled">
				<!-- no logic implemented to control is-filled currently,
					the marker only exists to notify that this field is important 
					(either search group or table must be selected)	
				-->
				<label class="required-marker" for="">Search Table</label>
			</div>
			<span class="col-sm-9">
				<div class="table-container" id="table-none-container">
					<g:ui_reference table="sys_db_object" columns="name;sys_scope" order_by="name"
						name="table-none"
						value="${metadataTableGr.getUniqueValue()}" displayvalue="${metadataTableGr.getDisplayValue()}" />
				</div>

				<g:evaluate>
					searchGroupGr.query();
				</g:evaluate>
				<j:while test="${searchGroupGr.next()}">
					<div class="table-container" id="table-${searchGroupGr.sys_id}-container" style="display:none">
						<g:ui_reference table="sys_db_object" columns="name;sys_scope" order_by="name"
							name="table-${searchGroupGr.sys_id}"
							query="nameIN${tables[searchGroupGr.name].join(',')}" />
					</div>
				</j:while>
			</span>
		</div>
		<div class="row form-group" id="search-extensions-container">
			<div class="col-sm-3"></div>
			<div class="col-sm-9">
				<span class="input-group-checkbox">
					<input id="search-extensions" class="checkbox" type="checkbox" name="search-extensions" checked="checked" />
					<label for="search-extensions" class="checkbox-label">Search Extensions$[SP]<span id="search-extensions-info">(only available for direct table search)</span></label>
				</span>
			</div>
		</div>
		<div class="row form-group">
			<div class="col-sm-3 control-label is-required">
				<label for="term" class="required-marker">Term</label>
			</div>
			<span class="col-sm-9 form-field">
				<input id="term" class="form-control" type="text" placeholder="Type a term" name="term" required="required" />
			</span>
		</div>
		<div class="row form-group">
			<label class="col-sm-3 control-label" for="scope">Scope</label>

			<span class="col-sm-9">
				<g:evaluate>
					const scopeGr = new GlideRecord('sys_scope');
					scopeGr.addQuery('sys_id', gs.getCurrentApplicationId());
					scopeGr.setLimit(1);
					scopeGr.query();
					scopeGr.next();
				</g:evaluate>
				<!-- Note:
					The explicit query is required here because the ui_reference macro sets a jvar_query variable
					which can (and in this case: is) carried over from the previous invocation of g:ui_reference
				-->
				<g:ui_reference name="scope" table="sys_scope" columns="name;scope" order_by="name"
					value="${scopeGr.sys_id}" displayValue="${scopeGr.name}"
					query="sys_id!=-1" />
			</span>
		</div>

		<div class="footer-buttons">
			<g:dialog_buttons_ok_cancel ok="return getResults()" ok_id="ok_button" cancel_type="button"
				cancel="clearSelections()" />
		</div>
	</g:ui_form>

</j:jelly>]]></html>
        <name>search_async</name>
        <processing_script/>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>markus.kraus@intrux.ch</sys_created_by>
        <sys_created_on>2025-12-14 11:48:12</sys_created_on>
        <sys_id>3a3099b1c3757e50de14d8477d013168</sys_id>
        <sys_mod_count>93</sys_mod_count>
        <sys_name>search_async</sys_name>
        <sys_package display_value="Intrux Code Search" source="x_itx_codesearch">389ff177c355f290de14d8477d013127</sys_package>
        <sys_policy/>
        <sys_scope display_value="Intrux Code Search">389ff177c355f290de14d8477d013127</sys_scope>
        <sys_update_name>sys_ui_page_3a3099b1c3757e50de14d8477d013168</sys_update_name>
        <sys_updated_by>markus.kraus@intrux.ch</sys_updated_by>
        <sys_updated_on>2026-01-01 09:46:00</sys_updated_on>
    </sys_ui_page>
</record_update>
